# Copyright (c) 2022 Qualcomm Innovation Center, Inc. All rights reserved.
# SPDX-License-Identifier: BSD-3-Clause-Clear

# Policy for sensor daemon
type vendor_sensors_qti, domain;
type vendor_sensors_qti_exec, exec_type, vendor_file_type, file_type;

init_daemon_domain(vendor_sensors_qti)
get_prop(vendor_sensors_qti, vendor_sensors_prop)


# Access to tests from userdebug/eng builds
userdebug_or_eng(`
  diag_use(vendor_sensors_qti)
  get_prop(vendor_sensors_qti, vendor_sensors_dbg_prop)

  #allow starting of diag_mdlog
  allow vendor_sensors_qti vendor_qlogd_exec:file rx_file_perms;
  allow vendor_sensors_qti vendor_shell_exec:file rx_file_perms;
')

allow vendor_sensors_qti self:{ socket qipcrtr_socket } create_socket_perms;
# ioctlcmd=c304
allowxperm vendor_sensors_qti self:{ socket qipcrtr_socket } ioctl msm_sock_ipc_ioctls;

allow vendor_sensors_qti mnt_vendor_file:dir r_dir_perms;

allow vendor_sensors_qti vendor_sensors_vendor_data_file:dir create_dir_perms;
allow vendor_sensors_qti vendor_sensors_vendor_data_file:file create_file_perms;

allow vendor_sensors_qti vendor_sensors_vendor_data_file:fifo_file create_file_perms;

#Allow to search SSR node directory
allow vendor_sensors_qti vendor_sysfs_slpi:dir search;
allow vendor_sensors_qti vendor_sysfs_slpi:file getattr;
